require(readxl)
require(dplyr)
require(data.table)

# ruta <- "/Users/Felipe/Dropbox/SAE/SAE.git/SAE/Calificacion-septimo-2015/input/Colegio/Covariable"
# setwd(ruta)

b12151=read_excel("input/Colegio/Covariable/2016_02_11 Agregados 2012-2015 Saber 11.xlsx","2012-20141")
b14215=read_excel("input/Colegio/Covariable/2016_02_11 Agregados 2012-2015 Saber 11.xlsx","20142-2015")

b2012=dplyr::filter(b12151,PERIODO=="2012")
b2013=dplyr::filter(b12151,PERIODO=="2013")
#b20141=dplyr::filter(b12151,PERIODO=="20141")
b20142=dplyr::filter(b14215,PERIODO=="20142")
b2015=dplyr::filter(b14215,PERIODO=="2015")

names(b2012)[c(1,4:12)]=c("PERIODO_2012", "PROM LENGUAJE_2012","PROM MATEMATICAS_2012","PROM CIENCIAS SOCIALES_2012","PROM FILOSOFIA_2012","PROM BIOLOGIA_2012","PROM QUIMICA_2012","PROM FISICA_2012","PROM INGLES_2012","ESTUDIANTES_2012")

names(b2013)[c(1,4:12)]=c("PERIODO_2013","PROM LENGUAJE_2013","PROM MATEMATICAS_2013","PROM CIENCIAS SOCIALES_2013","PROM FILOSOFIA_2013","PROM BIOLOGIA_2013","PROM QUIMICA_2013","PROM FISICA_2013","PROM INGLES_2013","ESTUDIANTES_2013")

#names(b20141)[c(1,4:12)]=c("PERIODO_20141","PROM LENGUAJE_20141","PROM MATEMATICAS_20141","PROM CIENCIAS SOCIALES_20141","PROM FILOSOFIA_20141","PROM BIOLOGIA_20141","PROM QUIMICA_20141","PROM FISICA_20141","PROM INGLES_20141","ESTUDIANTES_20141")

names(b20142)[c(1,4:9)]=c("PERIODO_20142","PROM LECTURA CRITICA_20142","PROM MATEMATICAS_20142","PROM SOCIA CIUDAD_20142","PROM CIENCIAS NATURALES_20142","PROM INGLES_20142","ESTUDIANTES_20142")

names(b2015)[c(1,4:9)]=c("PERIODO_2015","PROM LECTURA CRITICA_2015","PROM MATEMATICAS_2015","PROM SOCIA CIUDAD_2015","PROM CIENCIAS NATURALES_2015","PROM INGLES_2015","ESTUDIANTES_2015")


base=merge(b2012,b2013,by=c("DANE_ESTABLECIMIENTO", "DANE_SEDE"),all=T)%>%
     merge(b20142,by=c("DANE_ESTABLECIMIENTO", "DANE_SEDE"),all=T)%>%
     merge(b2015,by=c("DANE_ESTABLECIMIENTO", "DANE_SEDE"),all=T)

# base=merge(base,b20142,by=c("DANE_ESTABLECIMIENTO", "DANE_SEDE"),all=T)
# base=merge(base,b2015,by=c("DANE_ESTABLECIMIENTO", "DANE_SEDE"),all=T)
colnames(base)<-gsub(" ","_",colnames(base))
SB11 <-base
rm(list = c("b12151","b14215","b2012","b2013","b20142","b2015","base"))
